

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Protein mutation &mdash; pmx  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/msmb.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ligand mutation" href="ligand_mut.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/index.html">Scripts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Protein mutation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparation-of-hybrid-files">Preparation of hybrid files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-setup">System setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#equilibrium-md">Equilibrium MD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-equilibrium-md">Non-equilibrium MD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#free-energy-estimation">Free energy estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-results">Final results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ligand_mut.html">Ligand mutation</a></li>
<li class="toctree-l2"><a class="reference internal" href="nucleic_mut.html">DNA/RNA mutation</a></li>
<li class="toctree-l2"><a class="reference internal" href="large_scale_scans.html">Large-scale scans</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">Analysis</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../classes/index.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://pmx.mpibpc.mpg.de/webserver.html">Protein webserver</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pmx.mpibpc.mpg.de/dna_webserver.html">DNA webserver</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pmx</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Protein mutation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/protein_mut.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="protein-mutation">
<h1>Protein mutation<a class="headerlink" href="#protein-mutation" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we will show how <strong>pmx</strong> can be used to predict changes in
protein stability, similarly to what was done in <a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.1002/anie.201510054">Gapsys et al</a>.
All input files needed for this tutorial can be downloaded here: <a class="reference download internal" href="../_downloads/protein_mut_input.tar.gz" download=""><code class="xref download docutils literal notranslate"><span class="pre">input</span> <span class="pre">files</span></code></a>.</p>
<p>In order to calculate how a mutation affects the folding free energy of a protein
(<span class="math notranslate">\(\Delta \Delta G_{Folding}^{Mutation}\)</span>),
we need to calculate the free energy difference of
<em>alchemically</em> mutating both the folded and unfolded state of the protein (<span class="math notranslate">\(\Delta G_{Folded}^{Mutation} - \Delta G_{Unfolded}^{Mutation}\)</span>).
Effectively, we use the following thermodynamic cycle to recover <span class="math notranslate">\(\Delta \Delta G\)</span>
via the non-physical transformations shown as the horizontal legs of the cycle.</p>
<a class="reference internal image-reference" href="../_images/cycle.png"><img alt="../_images/cycle.png" class="align-center" src="../_images/cycle.png" style="width: 400px;" /></a>
<p>Here, we will go through the steps for the calculation of <span class="math notranslate">\(\Delta G_{Folded}^{Mutation}\)</span>,
using the <code class="docutils literal notranslate"><span class="pre">protein.pdb</span></code> file provided. <span class="math notranslate">\(\Delta G_{Unfolded}^{Mutation}\)</span> can be
obtained by following exactly the same steps, but using the file <code class="docutils literal notranslate"><span class="pre">tripeptide.pdb</span></code>
as the starting structure. These input <code class="docutils literal notranslate"><span class="pre">pdb</span></code> files have already been processed
so to contain hydrogen atoms and <em>amber</em> atom names.</p>
<div class="section" id="preparation-of-hybrid-files">
<h2>Preparation of hybrid files<a class="headerlink" href="#preparation-of-hybrid-files" title="Permalink to this headline">¶</a></h2>
<p>As an example system, here we use the <em>Trp-cage</em> miniprotein (file <code class="docutils literal notranslate"><span class="pre">protein.pdb</span></code>).
Firstly, we need to create a structure file containing the correct hybrid residue
needed for the mutation of interest. This can be done using the <code class="docutils literal notranslate"><span class="pre">pmx</span> <span class="pre">mutate</span></code> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pmx mutate -f protein.pdb -o mutant.pdb
</pre></div>
</div>
<p>The script will ask what force field you would like to use; to get the same results as
we report here, choose the <em>amber99sb-star-ildn-mut</em> one. Then, choose to mutate the Trp6 (W6) residue
into Phe (F).</p>
<p>Next, to create the corresponding topology to this hybrid structure, you need to
use the <code class="docutils literal notranslate"><span class="pre">gmx</span></code> tool <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> using the same force field you previously chose:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gmx pdb2gmx -f mutant.pdb -o conf.pdb -p topol.top -ff amber99sb-star-ildn-mut -water tip3p
</pre></div>
</div>
<p>The output topology <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> contains the hybrid residue W6F, like the structure
file <code class="docutils literal notranslate"><span class="pre">conf.pdb</span></code>. However, the B-state columns do not yet contain the right
information for Gromacs to run the calculations. To fill the B-states with the
necessary data, you can use the <code class="docutils literal notranslate"><span class="pre">pmx</span> <span class="pre">gentop</span></code> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pmx gentop -p topol.top -o newtop.top
</pre></div>
</div>
<p>Now with the <code class="docutils literal notranslate"><span class="pre">conf.pdb</span></code> and <code class="docutils literal notranslate"><span class="pre">newtop.top</span></code> files you are ready to setup the system
as you would do for a typical Gromacs simulation.</p>
<p>The steps just described can also be performed using the <strong>pmx webserver</strong>,
which you can find in the navigation bar on the left. Alternatively, you can
automate the above steps in a script using the <strong>pmx</strong> API as shown here and
also discussed in <a class="reference internal" href="../examples/index.html#examples"><span class="std std-ref">the examples</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">pmx</span> <span class="k">import</span> <span class="o">*</span>

<span class="c1"># load, mutate, and save the PDB file</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s1">&#39;peptide.pdb&#39;</span><span class="p">,</span> <span class="n">for_gmx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">mut_resid</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">mut_resname</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="s1">&#39;amber99sb-star-ildn-mut&#39;</span><span class="p">)</span>
<span class="n">m2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;mutant.pdb&#39;</span><span class="p">)</span>

<span class="c1"># run pdb2gmx</span>
<span class="n">gmx</span><span class="o">.</span><span class="n">pdb2gmx</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="s1">&#39;mutant.pdb&#39;</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;conf.pdb&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;topol.top&#39;</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="s1">&#39;amber99sb-star-ildn-mut&#39;</span><span class="p">,</span>
            <span class="n">water</span><span class="o">=</span><span class="s1">&#39;tip3p&#39;</span><span class="p">)</span>

<span class="c1"># load topology, fill B states, then write a new topology file</span>
<span class="n">topol</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="s1">&#39;topol.top&#39;</span><span class="p">)</span>
<span class="n">pmxtop</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gen_hybrid_top</span><span class="p">(</span><span class="n">topol</span><span class="p">)</span>
<span class="n">pmxtop</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;newtop.top&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="system-setup">
<h2>System setup<a class="headerlink" href="#system-setup" title="Permalink to this headline">¶</a></h2>
<p>Now we are ready to set up the system to be simulated in Gromacs. The following
are the standard steps used in any Gromacs simulation; you can find a more detailed
explaination of these steps in <a class="reference external" href="http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/lysozyme/index.html">this tutorial</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gmx editconf -f conf.pdb -o box.pdb -bt dodecahedron -d 1.0
$ gmx solvate -cp box -cs spc216 -p newtop -o water.pdb
$ gmx grompp -f genion.mdp -c water.pdb -p newtop.top -o genion.tpr
$ echo &quot;SOL&quot; | gmx genion -s genion.tpr -p newtop.top -neutral -conc 0.15 -o ions.pdb
</pre></div>
</div>
<p>Now we have the file <code class="docutils literal notranslate"><span class="pre">ions.pdb</span></code> containing our protein, solvated in a dodecahedral
box and with Na and Cl ions neutralising the solution at a concentration of 150 mM.
These setup steps can also be automated using the <a class="reference internal" href="../api/modules.html#module-pmx.gmx" title="pmx.gmx"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pmx.gmx</span></code></a> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pmx</span> <span class="k">import</span> <span class="n">gmx</span>

<span class="n">gmx</span><span class="o">.</span><span class="n">editconf</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="s1">&#39;conf.pdb&#39;</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;box.pdb&#39;</span><span class="p">,</span> <span class="n">bt</span><span class="o">=</span><span class="s1">&#39;dodecahedron&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">gmx</span><span class="o">.</span><span class="n">solvate</span><span class="p">(</span><span class="n">cp</span><span class="o">=</span><span class="s1">&#39;box.pdb&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="s1">&#39;spc216&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;newtop.top&#39;</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;water.pdb&#39;</span><span class="p">)</span>
<span class="n">gmx</span><span class="o">.</span><span class="n">grompp</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="s1">&#39;em.mdp&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;water.pdb&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;newtop.top&#39;</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;genion.tpr&#39;</span><span class="p">)</span>
<span class="n">gmx</span><span class="o">.</span><span class="n">genion</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;genion.tpr&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;newtop.top&#39;</span><span class="p">,</span> <span class="n">neutral</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;ions.pdb&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="equilibrium-md">
<h2>Equilibrium MD<a class="headerlink" href="#equilibrium-md" title="Permalink to this headline">¶</a></h2>
<p>At this stage, we are ready to start simulating the system. What we need to do
is to collect equilibrium configurations of the system in both its two end states;
i.e. state A in which residue 6 is a Trp, and state B in which it is Phe. Thus,
we will run energy minimisation, a short equilibration, and the production equilibrium MD
for both the end states. To keep things tidy, we use the following folder structure,
which should already be prepared in the archive with the input files you downloaded
at the top of this page.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span><span class="o">/</span>
<span class="o">|</span>
 <span class="o">--</span> <span class="n">forward</span><span class="o">/</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>    <span class="o">--</span> <span class="n">equil_md</span><span class="o">/</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>    <span class="o">--</span> <span class="n">nonequil_md</span><span class="o">/</span>
<span class="o">|</span>
 <span class="o">--</span> <span class="n">reverse</span><span class="o">/</span>
    <span class="o">|</span>
     <span class="o">--</span> <span class="n">equil_md</span><span class="o">/</span>
    <span class="o">|</span>
     <span class="o">--</span> <span class="n">nonequil_md</span><span class="o">/</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">pwd</span></code> is the current working directory where you have setup the system,
<code class="docutils literal notranslate"><span class="pre">forward</span></code> is the folder that will contain the equilibrium and non-equilibrium
data concerning the forward transformation (<span class="math notranslate">\(T6 \to F6\)</span>), and
<code class="docutils literal notranslate"><span class="pre">reverse</span></code> the folder with the data concerning the reverse transformation
(<span class="math notranslate">\(F6 \to T6\)</span>).</p>
<p>These are not very intensive simulations, so you might be able to run them on
your workstation if you have a GPU. However, they might still take some time (e.g. 2-3 hours), so
you might want to go get a coffee or submit them to a cluster and work on something else
in the meantime.</p>
<p>We start with running the equilibrium simulations needed for the forward transformation.
First we go into the relevant folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd forward/equil_md
</pre></div>
</div>
<p>Then, we run the minimisation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gmx grompp -f f_enmin.mdp -c ../../ions.pdb -p ../../newtop.top -o enmin.tpr
$ gmx mdrun -s enmin.tpr -deffnm enmin -v
</pre></div>
</div>
<p>The equilibration with position restraints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gmx grompp -f f_npt.mdp -c enmin.gro -p ../../newtop.top -o npt.tpr -maxwarn 1
$ gmx mdrun -s npt.tpr -deffnm npt -v
</pre></div>
</div>
<p>And finally the actual equilibrium MD run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gmx grompp -f f_equil.mdp -c npt.gro -p ../../newtop.top -o equil.tpr -maxwarn 1
$ gmx mdrun -s equil.tpr -deffnm equil -v
</pre></div>
</div>
<p>Now we have the equilibrium sampling needed for the <em>forward</em> transformation. For the
reverse one, we do exactly the same from the <code class="docutils literal notranslate"><span class="pre">reverse/equil_md</span></code> folder and using
the <em>reverse</em> mdp files (<code class="docutils literal notranslate"><span class="pre">r_*.mdp</span></code>) you find in it. Note that the only difference
in the <em>forward</em> and <em>reverse</em> mdp files is whether we choose to be in state <em>A</em>
(i.e. <em>0</em>, and in this case W6) or state <em>B</em> (i.e. <em>1</em>, F6):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is in the forward (f_*) mdp files</span>
<span class="n">free</span><span class="o">-</span><span class="n">energy</span>       <span class="o">=</span> <span class="n">yes</span>  <span class="p">;</span> <span class="n">use</span> <span class="n">free</span> <span class="n">energy</span> <span class="n">code</span>
<span class="n">init</span><span class="o">-</span><span class="k">lambda</span>       <span class="o">=</span> <span class="mi">0</span>    <span class="p">;</span> <span class="n">start</span> <span class="kn">from</span> <span class="nn">state</span> <span class="n">A</span>
<span class="n">delta</span><span class="o">-</span><span class="k">lambda</span>      <span class="o">=</span> <span class="mi">0</span>    <span class="p">;</span> <span class="n">stay</span> <span class="ow">in</span> <span class="n">state</span> <span class="n">A</span>

<span class="c1"># and this is in the reverse (r_*) mdp files</span>
<span class="n">free</span><span class="o">-</span><span class="n">energy</span>       <span class="o">=</span> <span class="n">yes</span>  <span class="p">;</span> <span class="n">use</span> <span class="n">free</span> <span class="n">energy</span> <span class="n">code</span>
<span class="n">init</span><span class="o">-</span><span class="k">lambda</span>       <span class="o">=</span> <span class="mi">1</span>    <span class="p">;</span> <span class="n">start</span> <span class="kn">from</span> <span class="nn">state</span> <span class="n">B</span>
<span class="n">delta</span><span class="o">-</span><span class="k">lambda</span>      <span class="o">=</span> <span class="mi">0</span>    <span class="p">;</span> <span class="n">stay</span> <span class="ow">in</span> <span class="n">state</span> <span class="n">B</span>
</pre></div>
</div>
<p>As before, these steps can be automated using the <a class="reference internal" href="../api/modules.html#module-pmx.gmx" title="pmx.gmx"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pmx.gmx</span></code></a> module. Nonetheless,
in practice, if you need to run many or more demanding calculations (e.g. longer/more
simulations of larger systems) you will probably do this on some computing cluster, so
that you will find more convenient to include the above steps in your submit script.</p>
</div>
<div class="section" id="non-equilibrium-md">
<h2>Non-equilibrium MD<a class="headerlink" href="#non-equilibrium-md" title="Permalink to this headline">¶</a></h2>
<p>Once we have collected equilibrium samples of the systems of interest, we can
move on with the non-equilibrium part of the calculations, which will provide
the work values needed for the free energy estimate.</p>
<p>For this, we move into the <code class="docutils literal notranslate"><span class="pre">forward/nonequil_md</span></code> folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ../../forward/nonequil_md/
</pre></div>
</div>
<p>Then, we extract 50 snapshots from the 5 ns equilibrium simulation (i.e. one every 100 ps,
starting with the one at 100 ps) using <code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">trjconv</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo &quot;System&quot; | gmx trjconv -f ../equil_md/equil.trr -s ../equil_md/equil.tpr -sep -b 100 -o frame_.gro
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.trr</span></code> file is used so that the starting snapshots contain
the velocities from the equilibrium sampling. At this point you should have 50 <code class="docutils literal notranslate"><span class="pre">gro</span></code> files
in the folder, indexed from 0 to 49. Now we create a folder for each starting frame,
so to have a different folder (index from 1 to 50) for each non-equilibrium trajectory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ for i in $( seq 0 49 ); do n=$((i+1)); mkdir frame$n; mv frame_$i.gro frame$n/frame.gro; done
</pre></div>
</div>
<p>Now you are ready to run 50 non-equilibrium forward transitions starting from
these frames. The length of each non-equilibrium trajectory we use here is 80 ps;
however, depending on the specifics of the system, you might need to use longer
trajectories or you might get away with shorter ones (see the <a class="reference internal" href="analysis.html#tutorial-analysis"><span class="std std-ref">analysis tutorial</span></a> for
more details on this). The important/non-standard bit in the <code class="docutils literal notranslate"><span class="pre">f_nonequil.mdp</span></code> file
is the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">free</span><span class="o">-</span><span class="n">energy</span>       <span class="o">=</span> <span class="n">yes</span>
<span class="n">init</span><span class="o">-</span><span class="k">lambda</span>       <span class="o">=</span> <span class="mi">0</span>        <span class="p">;</span> <span class="n">start</span> <span class="kn">from</span> <span class="nn">state</span> <span class="n">A</span>
<span class="n">delta</span><span class="o">-</span><span class="k">lambda</span>      <span class="o">=</span> <span class="mf">2.5e-05</span>  <span class="p">;</span> <span class="n">complete</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">number</span> <span class="n">of</span> <span class="n">steps</span>
<span class="n">sc</span><span class="o">-</span><span class="n">coul</span>           <span class="o">=</span> <span class="n">yes</span>   <span class="p">;</span> <span class="n">use</span> <span class="n">soft</span><span class="o">-</span><span class="n">core</span> <span class="n">also</span> <span class="k">for</span> <span class="n">coulombic</span> <span class="n">interactions</span>
<span class="n">sc</span><span class="o">-</span><span class="n">alpha</span>          <span class="o">=</span> <span class="mf">0.3</span>   <span class="p">;</span> <span class="n">soft</span><span class="o">-</span><span class="n">core</span>
<span class="n">sc</span><span class="o">-</span><span class="n">sigma</span>          <span class="o">=</span> <span class="mf">0.25</span>  <span class="p">;</span>
<span class="n">sc</span><span class="o">-</span><span class="n">power</span>          <span class="o">=</span> <span class="mi">1</span>     <span class="p">;</span>
<span class="n">nstdhdl</span>           <span class="o">=</span> <span class="mi">1</span>     <span class="p">;</span> <span class="n">write</span> <span class="n">to</span> <span class="n">dhdl</span> <span class="n">at</span> <span class="n">each</span> <span class="n">step</span>
</pre></div>
</div>
<p>which effectively says to use the free energy code, to go from state <span class="math notranslate">\(0\)</span> to <span class="math notranslate">\(1\)</span> in
<span class="math notranslate">\(40,000\)</span> steps of size <span class="math notranslate">\(2.5 \times 10^{-5}\)</span>, and to use a
soft-core potential for both Lennard-Jones and Coulombic interactions.</p>
<p>Depending on your computing setup/situation, you can run these simulations in parallel or one after
the other one. Here, we run them locally and in series in this way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ for i in $( seq 1 50 ); do
$   cd frame$i
$   gmx grompp -f ../f_nonequil.mdp -c frame.gro -p ../../../newtop.top -o nonequil.tpr -maxwarn 1
$   gmx mdrun -s nonequil.tpr -deffnm nonequil -dhdl dgdl.xvg -v
$   cd ../
$ done
</pre></div>
</div>
<p>The files you really need for the free energy estimate are the <code class="docutils literal notranslate"><span class="pre">dgdl.xvg</span></code> files.
You need these also for the reverse transformation, which you can obtain by
going through the same steps described here while using the files in the <code class="docutils literal notranslate"><span class="pre">reverse</span></code>
folder. The <code class="docutils literal notranslate"><span class="pre">r_nonequil.mdp</span></code> file you will use is the same as the <code class="docutils literal notranslate"><span class="pre">f_nonequil.mdp</span></code>
file, apart from the two following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">init</span><span class="o">-</span><span class="k">lambda</span>       <span class="o">=</span> <span class="mi">1</span>        <span class="p">;</span> <span class="n">start</span> <span class="kn">from</span> <span class="nn">state</span> <span class="n">B</span>
<span class="n">delta</span><span class="o">-</span><span class="k">lambda</span>      <span class="o">=</span> <span class="o">-</span><span class="mf">2.5e-05</span> <span class="p">;</span> <span class="n">complete</span> <span class="n">transition</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">number</span> <span class="n">of</span> <span class="n">steps</span>
</pre></div>
</div>
<p>Since in the reverse case we need to start from state <span class="math notranslate">\(1\)</span> (i.e. B, F6) and
go to state <span class="math notranslate">\(0\)</span> (i.e. A, W6).</p>
</div>
<div class="section" id="free-energy-estimation">
<h2>Free energy estimation<a class="headerlink" href="#free-energy-estimation" title="Permalink to this headline">¶</a></h2>
<p>Great! Now we have all the data needed for estimating <span class="math notranslate">\(\Delta G_{Folded}^{Mutation}\)</span>,
which is stored in the <code class="docutils literal notranslate"><span class="pre">forward/nonequil_md/frame*/dgdl.xvg</span></code> and
<code class="docutils literal notranslate"><span class="pre">reverse/nonequil_md/frame*/dgdl.xvg</span></code> files.</p>
<p>The simplest way to estimate the free energy difference is to use the <code class="docutils literal notranslate"><span class="pre">pmx</span> <span class="pre">analyse</span></code>
tool. For instance, here we use it to estimate <span class="math notranslate">\(\Delta G_{Folded}^{Mutation}\)</span>
with BAR:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pmx analyse -fA forward/nonequil_md/frame*/dgdl.xvg -fB reverse/nonequil_md/frame*/dgdl.xvg -t 298.15 -m bar
</pre></div>
</div>
<p>For a more detailed discussion about free energy estimation and data analysis you
can have a look at the <a class="reference internal" href="analysis.html#tutorial-analysis"><span class="std std-ref">analysis tutorial</span></a>. In brief,
for this calculation, this is the distribution of work values and the BAR
<span class="math notranslate">\(\Delta G\)</span> estimate we obtained:</p>
<img alt="../_images/protein_mut_wdist.png" src="../_images/protein_mut_wdist.png" />
<p>Often, the easiest way to get reliable error estimates is to just repeat the
whole calculation multiple times to obtain a standard error. For this example,
we repeated the above steps 5 times, and obtained the following mean and standard error:</p>
<div class="math notranslate">
\[\Delta G_{Folded}^{Mutation} = 9.75 \pm 1.48\ kJ/mol\]</div>
</div>
<div class="section" id="final-results">
<h2>Final results<a class="headerlink" href="#final-results" title="Permalink to this headline">¶</a></h2>
<p>At this point, if you still remember, the number we were interested in was <span class="math notranslate">\(\Delta \Delta G_{Folding}^{Mutation}\)</span>,
that is, the change in the folding free energy upon introducing the W6F mutation.
This value is recovered from <span class="math notranslate">\(\Delta G_{Folded}^{Mutation}\)</span>, which we just
calculated, and <span class="math notranslate">\(\Delta G_{Unfolded}^{Mutation}\)</span>, which you can obtain by running
the calculations starting from <code class="docutils literal notranslate"><span class="pre">tripeptide.pdb</span></code> rather than <code class="docutils literal notranslate"><span class="pre">protein.pdb</span></code>.
Using 5 repeats, we obtained the following mean and standard error for the latter
free energy difference:</p>
<div class="math notranslate">
\[\Delta G_{Unfolded}^{Mutation} = -4.82 \pm 0.19\ kJ/mol\]</div>
<p>Thus, our final result of interest is the following:</p>
<div class="math notranslate">
\[\begin{split}\Delta \Delta G_{Folding}^{Mutation} &amp;= \Delta G_{Folded}^{Mutation} - \Delta G_{Unfolded}^{Mutation} = \\
                                     &amp;= 9.75 \pm 1.48\ - (-4.82 \pm 0.19) =  \\
                                     &amp;= 14.57 \pm 1.49\ kJ/mol\end{split}\]</div>
<p>This suggests that the W6F mutation has a destabilising effect on the fold of
Trp-cage of about <span class="math notranslate">\(14.6 \pm 1.5\ kJ/mol\)</span>, which is not far from the
experimentally determined value of <span class="math notranslate">\(12.5 \pm 0.6\ kJ/mol\)</span>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ligand_mut.html" class="btn btn-neutral float-right" title="Ligand mutation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, The Authors.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <script>
    var versions_json_url = ''
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../_static/js/versions.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>